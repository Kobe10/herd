<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta name="description" content="究竟谁能脱颖而出，摘得市级决赛的桂冠？" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="./style/home.css" />
  <title>《浙江诗词大会》市级决赛今日正式开赛！</title>
</head>

<body>
  <img id="imgForShare" style="position: fixed; left: -1000%; top: -1000%;"
    src="http://x0.ifengimg.com/cmpp/2020_31/eca1633215d8a82_size62_w300_h300.png" alt="分享缩略图" />
  <div id="ifeng_share_thumbnail" style="display:none"></div>
  <div id="ifeng_share_title" style="display:none"></div>
  <div id="ifeng_share_description" style="display:none"></div>
  <div id="ifeng_share_url" style="display:none"></div>
  <div class="content">
    <div class="content_2">
      <div class="con">
        <div class="con_tit grtit"></div>
        <div class="input_cont">
          <input type="text" placeholder="请输入您的报名码" class="grSearch">
        </div>
        <div class="submit submit_gr">大赛答题入口</div>
        <div class="erwei"><img src="./images/erwei.png"></div>
        <div class="gr_search_tit">更多大赛最新资讯，重磅奖品爆料<br>
          敬请关注凤凰网浙江教育微信公众号</div>
      </div>
    </div>
    <div class="content_3" style="display:none">
      <div class="con">
        <div class="con_tit"></div>
        <div class="input_cont">
          <span class="tit_name">姓名</span>
          <input type="text" placeholder="请输入姓名" class="input_name">
        </div>
        <div class="input_cont">
          <span class="tit_name">赛区</span>

          <select id="input_add" class="input_add">
            <option selected="selected" disabled="disabled" style='display: none' value=''></option>

            <option value="330100">杭州市 </option>
            <option value="330200"> 宁波市 </option>
            <option value="330300"> 温州市 </option>
            <option value="330600"> 绍兴市 </option>
            <option value="330500"> 湖州市 </option>
            <option value="330400"> 嘉兴市 </option>
            <option value="330700"> 金华市 </option>
            <option value="330800"> 衢州市 </option>
            <option value="331000"> 台州市 </option>
            <option value="331100"> 丽水市 </option>
            <option value="330900"> 舟山市 </option>

          </select>

          <!-- <input type="text" placeholder="请输入赛区" class="input_add"> -->
        </div>
        <div class="input_cont">
          <span class="tit_name">学校</span>

          <input type="text" placeholder="请输入学校" class="input_school">
        </div>
        <div class="input_cont">
          <span class="tit_name">年级</span>
          <!-- <input type="text" placeholder="请输入年级" class="input_grade"> -->
          <select id="input_grade" class="input_grade">
            <option selected="selected" disabled="disabled" style='display: none' value=''></option>
            <option value="one">幼儿园</option>
            <option value="two">一年级</option>
            <option value="three">二年级</option>
            <option value="four">三年级</option>
            <option value="five">四年级</option>
            <option value="six">五年级</option>
            <option value="seven">六年级 </option>
            <option value="eight">七年级 </option>
            <option value="nine">八年级 </option>
            <option value="ten"> 九年级 </option>
            <option value="eleven"> 高一 </option>
            <option value="twelve"> 高二 </option>
            <option value="thirteen"> 高三 </option>
            <option value="fourteen"> 大学 </option>

          </select>
        </div>
        <div class="input_cont">
          <span class="tit_name">电话</span>
          <input type="text" placeholder="请输入电话" class="input_phone">
        </div>
        <div class="input_cont">
          <span class="tit_name">微信</span>
          <input type="text" placeholder="请输入微信号" class="input_wx">
        </div>
        <div class="submit submit_information">确定</div>
      </div>
    </div>
    <div class="content_4" style="display:none">
      <div class="con">
        <div class="tit3_img"></div>
        <div class="tit3_txt">
          <p><b>答题规则：</b>点击下方“开始答题”按钮即可进入答题页面。共计50题，答题时间限12分钟。</p>
          <p><b>答题次数：</b>每位参赛选手有且仅有1次答题机会。请各位选手在网络环境良好的情况下参与比赛。开始答题后，请勿以任何方式退出答题页面，以免影响个人最终成绩。</p>
          <p>
            <b>比赛时间：</b>请选手在规定的答题通道开放时间内进入答题页面进行答题。开始答题后，选手需在12分钟内答题完毕。12分钟后，若选手未提交答卷，系统将自动保存答案并提交。
          </p>
          <p>
            <b>排行榜：</b>本轮比赛设有地市参赛选手排行榜。排行榜将根据选手的答题准确率及答题用时进行排序，答题准确率优先。相同准确率的情况下，按选手答题用时排序。
          </p>
          <p>
            <b>晋级方式：</b>本轮比赛11个地市将共有100个名额晋级省级初赛。各地市前5名选手将直接晋级省级初赛，剩余晋级名额将根据《浙江诗词大会》正式初赛省级排行榜前500名选手各地市所占比例分配（向上取整）。具体名单以赛区群公布为准。若录取的最后一名出现同分情况（答题准确率跟答题用时均相同），同分选手均可晋级市级决赛。
          </p>
          <p>
            <b>注意：</b>本次大赛秉持公平公正原则，请选手们自觉遵守大赛规则，若发现舞弊行为，一律取消参赛资格。本次大赛活动的最终解释权归凤凰网所有。
          </p>
          <p><input type="checkbox" class="yd" />我已阅读并了解大赛相关规则，自愿遵守、诚信参赛。</p>
          <div class="begin">开始答题</div>
        </div>
      </div>
    </div>
  </div>
  <div class="back"></div>
  <div class="tc"></div>

  <div class="tmtc">
    <p>报名信息仅可修改1次，是否确认提交？</p>
    <span class="qr">是</span>
    <span class="jxdt">否</span>
  </div>
</body>
<script src="https://p2.ifengimg.com/l/2018/27/61a49b087c93575/jquery-1.7.2.min.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script>
  var shareIcon = document.getElementById('imgForShare').src,
    shareTitle = '《浙江诗词大会》市级决赛今日正式开赛！',
    shareContent = document.querySelector('meta[name=description]') ? document.querySelector('meta[name=description]')
    .getAttribute('content') : '究竟谁能脱颖而出，摘得市级决赛的桂冠？',
    shareLink = window.location.href;
  document.getElementById("ifeng_share_title").innerHTML = shareTitle;
  document.getElementById("ifeng_share_thumbnail").innerHTML = shareIcon;
  document.getElementById("ifeng_share_description").innerHTML = shareContent;
  document.getElementById("ifeng_share_url").innerHTML = shareLink;
  if (/MicroMessenger/.test(navigator.userAgent)) {
    var wxConfigParams = {};
    $.ajax({
      url: 'https://api.cmpp.v.ifeng.com/api/Secert',
      type: 'get',
      dataType: 'jsonp',
      data: {
        url: encodeURIComponent(window.location.href),
        _: '',
        rt: 'jsonp',
      },
      success: function (data) {
        wxConfigParams.debug = false;
        wxConfigParams.appId = data.data.appId;
        wxConfigParams.timestamp = data.data.timestamp;
        wxConfigParams.nonceStr = data.data.nonceStr;
        wxConfigParams.signature = data.data.signature;
        wxConfigParams.jsApiList = ['onMenuShareAppMessage', 'onMenuShareTimeline', 'onMenuShareQQ',
          'onMenuShareQZone'
        ];
        wx.config(wxConfigParams);
        wx.ready(function () {
          wx.onMenuShareAppMessage({
            title: shareTitle,
            desc: shareContent,
            link: shareLink,
            imgUrl: shareIcon
          });
          wx.onMenuShareQZone({
            title: shareTitle,
            desc: shareContent,
            link: shareLink,
            imgUrl: shareIcon
          });
          wx.onMenuShareQQ({
            title: shareTitle,
            desc: shareContent,
            link: shareLink,
            imgUrl: shareIcon
          });
          wx.onMenuShareTimeline({
            title: shareTitle,
            link: shareLink,
            imgUrl: shareIcon
          });
        });
      },
      error: function (data) {}
    });
  }
</script>
<script src="./scripts/common.js"></script>
<script>
  $(function () {
    //输入报名码
    var button_search = $('.button_search'),
      tc = $('.tc'),
      qr = $('.qr'),
      jxdt = $('.jxdt');

    button_search.click(function () {
      var input_search = $('.input_search').val();
      console.log(input_search)
      if (input_search.length == 0) {
        tc.show()
        tc.html('请输入正确的报名码')
        setTimeout(function () {
          tc.hide()
        }, 3000)
      }
    })

    //提交信息
    var submit_gr = $('.submit_gr');
    $('.grSearch').val(sessionStorage.getItem('competitionCode'))
    submit_gr.click(function () {
      var grSearch = $('.grSearch').val();
      console.log(111)
      $.ajax({
        url: host + "/api/base/login",
        type: "post",
        contentType: "application/json",
        dataType: "JSON",
        data: JSON.stringify({
          "competitionCode": grSearch //sessionStorage.getItem('competitionCode')
        }),
        success: function (res) {
          if (res.code == 200) {
            if (res.data) {
              $('.content_2').hide()
              if (res.data.isCheckUserInfo != 0) {
                $('.content_4').show()

              } else {
                sessionStorage.setItem('competitionCode', res.data.competitionCode)
                sessionStorage.setItem('uid', res.data.loginUserInfoVo.uid)

                //默认赋值操作
                var resdata = res.data.loginUserInfoVo
                console.log(res.data.isCheckUserInfo)
                $('.input_name').val(resdata.userName)
                $('#input_add').val(resdata.areaCode)
                $('.input_school').val(resdata.school)
                $('#input_grade').val(resdata.grade)
                $('.input_phone').val(resdata.phone)
                $('.input_wx').val(resdata.wxNum)
                $('.content_3').show()
              }
              // window.location.replace('./index_form.html')
            }
          } else {
            tc.show()
            tc.html(res.message)
            setTimeout(function () {
              tc.hide()
            }, 3000)
          }
        }
      })
    })


    var submit_information = $('.submit_information');
    submit_information.click(function () { //提交一次得信息弹窗
      $('.tmtc').show()
    })
    jxdt.click(function () {
      $('.tmtc').hide()
    })
    //确认提交信息
    qr.click(function () {
      $('.tmtc').hide()
      var input_name = $('.input_name').val().trim(),
        input_add = $("#input_add option:selected").val(), //赛区input_add
        input_school = $('.input_school').val().trim(),
        input_grade = $('#input_grade option:selected').val().trim(),
        input_phone = $('.input_phone').val().trim(),
        input_wx = $('.input_wx').val().trim();
      checkPhone(input_phone) //手机号正则验证
      sessionStorage.setItem('areaCode', input_add)
      // checkName(input_name) //姓名正则验证
      //如果有一项为空 做验证
      if (!input_name.length || !input_add.length || !input_school.length || !input_grade.length || !input_phone
        .length || !input_wx.length) {
        tc.show()
        tc.html('请填写完整的信息')
        setTimeout(function () {
          tc.hide()
        }, 3000)
      } else {
        //用户信息的提交
        var uidCode = sessionStorage.getItem('uid')
        var parms = {
          "areaCode": input_add,
          "grade": input_grade,
          "phone": input_phone,
          "school": input_school,
          "uid": uidCode,
          "userName": input_name,
          "wxNum": input_wx
        }
        $.ajax({
          url: host + "/api/base/update/user/info",
          type: "post",
          contentType: "application/json",
          dataType: "JSON",
          data: JSON.stringify(parms),
          success: function (res) {
            if (res.code == 200) {
              console.log(res)
              $('.content_3').hide()
              $('.content_4').show()
            } else {
              tc.show()
              tc.html(res.message)
              setTimeout(function () {
                tc.hide()
              }, 3000)
            }

          }
        })
      }
    })

    //阅读规则
    var begin = $('.begin');

    begin.click(function () {
      var yd = $('.yd');
      if (yd.attr('checked') == 'checked') {
        window.location.replace('./index.shtml')
      } else {
        tc.show()
        tc.html('请阅读答题规则，并同意')
        setTimeout(function () {
          tc.hide()
        }, 3000)
      }
    })

    $('.back').click(function () {
      history.go(-100)
      console.log(111)
      window.location.replace('./index_home.shtml')
    })


  })
</script>

</html>